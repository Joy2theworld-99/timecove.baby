<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Timecove Monitor: Lyo & Lya</title>
<style>
  :root{
    --bg:#0e0f11;
    --card:#16181b;
    --text:#f4f6f8;
    --muted:#a4acb5;

    --calm:#27d4d0;          /* teal */
    --sleep:#6f78ff;         /* indigo */

    --hungry:#ff4d4d;        /* red */
    --diaper:#ff9f2e;        /* orange */
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Inter,Roboto,Helvetica,Arial,sans-serif;
    display:flex; flex-direction:column; align-items:center; gap:24px; padding:20px;
  }
  h1{margin:6px 0 2px; font-weight:900; letter-spacing:.5px; text-align:center}

  .row{
    --stage: clamp(260px, 44vw, 360px);
    display:flex; gap:24px; flex-wrap:wrap; justify-content:center; width:100%;
  }
  .monitor{
    width: min(560px, 96vw);
    background:var(--card);
    border-radius:24px;
    padding:20px 18px 16px;
    box-shadow:0 16px 40px rgba(0,0,0,.4), inset 0 0 0 1px rgba(255,255,255,.03);
  }
  .name{font-size:clamp(22px, 4vw, 28px); font-weight:900; text-align:center; margin:6px 0 6px}

  .stage{
    position:relative; width:var(--stage); height:var(--stage); margin:6px auto 10px;
    display:grid; place-items:center;
  }
  .avatar{
    width: calc(var(--stage) * 0.58);
    height: calc(var(--stage) * 0.58);
    border-radius:50%;
    background:#0d0e10 center/cover no-repeat;
    position:relative; z-index:3;
    box-shadow:0 10px 24px rgba(0,0,0,.35) inset, 0 0 0 1px rgba(255,255,255,.04);
  }

  svg.halo{ position:absolute; inset:0; overflow:visible; z-index:2 }

  .baseline{
    fill:none; stroke-width: calc(var(--stage) * 0.04);
    opacity:.22; transform-origin:50% 50%;
    filter: drop-shadow(0 0 14px currentColor) drop-shadow(0 0 26px currentColor);
  }
  .baseline.calm{ color:var(--calm); stroke:var(--calm); animation:breathe 6.5s ease-in-out infinite }
  .baseline.sleep{ color:var(--sleep); stroke:var(--sleep); opacity:.18; animation:breath-sleep 8.5s ease-in-out infinite }

  @keyframes breathe{
    0%,100%{ transform:scale(1); opacity:.22 }
    50%    { transform:scale(1.06); opacity:.32 }
  }
  @keyframes breath-sleep{
    0%,100%{ transform:scale(1); opacity:.18 }
    50%    { transform:scale(1.04); opacity:.26 }
  }

  .ring{
    fill:none; stroke-width: calc(var(--stage) * 0.035); transform-origin:50% 50%;
    filter: drop-shadow(0 0 10px currentColor) drop-shadow(0 0 22px currentColor);
    opacity:1; transition:opacity .2s ease;
  }
  .cooldown{ animation:cooldown .9s ease forwards }
  @keyframes cooldown{ to{ opacity:0; transform:scale(.88) } }

  /* Gentle nudge pulse for unattended diaper */
  .nudgePulse{ animation:nudgePulse .9s ease-in-out 3 }
  @keyframes nudgePulse{
    0%{ transform:scale(1) }
    50%{ transform:scale(1.06) }
    100%{ transform:scale(1) }
  }

  .controls{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:10px }

  .pill{
    border:0; color:#fff; font-weight:800; border-radius:999px;
    padding:12px 16px; cursor:pointer; box-shadow:0 6px 18px rgba(0,0,0,.35);
    transition:transform .06s ease, filter .2s ease; font-size:15px;
  }
  .pill:active{ transform:translateY(1px) }
  .resolve{ display:none }
  .resolve.hungry{ background:var(--hungry) }
  .resolve.diaper{ background:var(--diaper) }

  .toggle{ background:#2b2e35; color:var(--text) }
  .toggle.active.calm{ background:var(--calm) }
  .toggle.active.sleep{ background:var(--sleep) }

  .meta{ text-align:center; color:var(--muted); font-size:13px; margin-top:8px }
  .countdown{ font-weight:800; color:#e9f5f6 }
  .small{ font-size:12px; color:#cfd6de }

  .inline{
    display:flex; align-items:center; gap:10px; justify-content:center; flex-wrap:wrap;
    margin-top:8px;
  }
  select.bottle, .num{
    background:#23262b; color:var(--text); border:1px solid #2e3238; border-radius:10px;
    padding:8px 10px; font-weight:700; width:95px;
  }
  .num{ width:80px; text-align:center }
  .btnSave{
    background:#2e844a; border:0; color:#fff; font-weight:800; padding:8px 12px; border-radius:10px;
    box-shadow:0 6px 18px rgba(0,0,0,.35); cursor:pointer;
  }

  .log{
    margin-top:12px; background:#121417; border-radius:14px; padding:10px 12px;
    border:1px solid rgba(255,255,255,.05);
    max-height:160px; overflow:auto;
  }
  .log h4{ margin:0 0 8px 0; font-size:13px; color:#cdd6df; letter-spacing:.3px }
  .entry{
    display:flex; justify-content:space-between; gap:10px; font-size:13px;
    padding:6px 0; border-top:1px dashed rgba(255,255,255,.06);
  }
  .entry:first-of-type{ border-top:none }
  .ts{ color:#c8d3dd }
  .tag{
    background:#2b2e35; color:#fff; font-weight:800; padding:4px 8px; border-radius:999px;
  }

  /* Toasts */
  .toasts{
    position:fixed; right:14px; bottom:16px; display:flex; flex-direction:column; gap:10px;
    z-index:9999;
  }
  .toast{
    background:#1b1e22; color:#fff; border:1px solid rgba(255,255,255,.08);
    padding:10px 12px; border-radius:12px; box-shadow:0 10px 24px rgba(0,0,0,.4);
    font-weight:700; font-size:14px; opacity:0; transform:translateY(10px);
    transition:opacity .2s ease, transform .2s ease;
  }
  .toast.show{ opacity:1; transform:translateY(0) }
  .t-red{ border-color:rgba(255,77,77,.35) }
  .t-orange{ border-color:rgba(255,159,46,.35) }
  .t-teal{ border-color:rgba(39,212,208,.35) }
</style>
</head>
<body>

<h1>Timecove Monitor: Lyo & Lya</h1>

<div class="row">
  <!-- LYO -->
  <section class="monitor" id="lyo-card">
    <div class="name">Lyo</div>
    <div class="stage">
      <svg class="halo" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
        <circle id="lyo-base" class="baseline calm" cx="50" cy="50" r="38"/>
        <g id="lyo-rings"></g>
      </svg>
      <div id="lyo-avatar" class="avatar"
           style="background-image:url('Lyo_Glyph_Clear.png');"></div>
    </div>

    <div class="controls" id="lyo-controls"></div>

    <div class="inline">
      <label for="lyo-bottle">Bottle:</label>
      <select id="lyo-bottle" class="bottle">
        <option>EchoSip</option>
        <option>Starbottle</option>
        <option>Dreammilk</option>
      </select>
      <span>Interval:</span>
      <input id="lyo-h" class="num" type="number" min="0" value="2">h
      <input id="lyo-m" class="num" type="number" min="0" max="59" value="15">m
      <button class="btnSave" id="lyo-save">Save</button>
      <div style="flex:1 1 100%; height:0"></div>
      <div class="meta">Next feed in: <span id="lyo-eta" class="countdown">—</span></div>
      <div class="small" id="lyo-diaper-wait"></div>
    </div>

    <div class="controls" id="lyo-mood"></div>

    <div class="log" id="lyo-log">
      <h4>Feeding Log</h4>
      <div class="entries feed"></div>
      <h4 style="margin-top:10px;">Diaper Log</h4>
      <div class="entries diaper"></div>
    </div>
  </section>

  <!-- LYA -->
  <section class="monitor" id="lya-card">
    <div class="name">Lya</div>
    <div class="stage">
      <svg class="halo" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
        <circle id="lya-base" class="baseline calm" cx="50" cy="50" r="38"/>
        <g id="lya-rings"></g>
      </svg>
      <div id="lya-avatar" class="avatar"
           style="background-image:url('Lya_Glyph_Clear.png');"></div>
    </div>

    <div class="controls" id="lya-controls"></div>

    <div class="inline">
      <label for="lya-bottle">Bottle:</label>
      <select id="lya-bottle" class="bottle">
        <option>EchoSip</option>
        <option>Starbottle</option>
        <option>Dreammilk</option>
      </select>
      <span>Interval:</span>
      <input id="lya-h" class="num" type="number" min="0" value="2">h
      <input id="lya-m" class="num" type="number" min="0" max="59" value="45">m
      <button class="btnSave" id="lya-save">Save</button>
      <div style="flex:1 1 100%; height:0"></div>
      <div class="meta">Next feed in: <span id="lya-eta" class="countdown">—</span></div>
      <div class="small" id="lya-diaper-wait"></div>
    </div>

    <div class="controls" id="lya-mood"></div>

    <div class="log" id="lya-log">
      <h4>Feeding Log</h4>
      <div class="entries feed"></div>
      <h4 style="margin-top:10px;">Diaper Log</h4>
      <div class="entries diaper"></div>
    </div>
  </section>
</div>

<!-- Toast container -->
<div class="toasts" id="toasts"></div>

<script>
/* ---------------- CONFIG ----------------
   DEMO: 1 minute = 1 second for quick testing. */
const DEMO = true;
const MILLIS_PER_MIN = DEMO ? 1000 : 60_000;

/* Probability of needs on wake (0..1) */
const HUNGRY_ON_WAKE_PROB = 0.30;
const DIAPER_ON_WAKE_PROB = 0.25;

/* Gentle nudge if diaper unresolved >= this many minutes */
const DIAPER_NUDGE_MIN = DEMO ? 5 : 10;

const SLEEP_RANDOM = {
  min: DEMO ? 3 : 30,
  max: DEMO ? 7 : 120
};

const STORAGE_KEY = 'timecove.twins.v5';

const COLOR = {
  hungry: css('--hungry'),
  diaper: css('--diaper'),
  calm:   css('--calm'),
  sleep:  css('--sleep')
};
function css(v){ return getComputedStyle(document.documentElement).getPropertyValue(v).trim(); }

/* ------------ WebAudio tiny chimes ------------ */
let AC=null, unlocked=false;
function ensureAudio(){
  if(!AC) AC = new (window.AudioContext||window.webkitAudioContext)();
  if(AC.state==='suspended') AC.resume();
}
window.addEventListener('pointerdown', ()=>{ ensureAudio(); unlocked=true; }, {once:true});

function tone(freq, dur=0.15, gain=0.06, type='sine', when=0){
  if(!AC) return;
  const t=AC.currentTime+when, o=AC.createOscillator(), g=AC.createGain();
  o.type=type; o.frequency.value=freq; o.connect(g); g.connect(AC.destination);
  g.gain.value=0; g.gain.linearRampToValueAtTime(gain, t+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, t+dur);
  o.start(t); o.stop(t+dur+0.05);
}
function chimeHungry(){ if(!unlocked) return; ensureAudio(); tone(880,.16,.06,'sine',0); tone(1318.5,.18,.05,'triangle',.08); }
function chimeFed(){ if(!unlocked) return; ensureAudio(); tone(659.25,.12,.05,'sine',0); tone(523.25,.14,.05,'sine',.08); }

/* -------- Notifications (toast + optional vibrate + Web Notification) -------- */
function toast(msg, cls=''){
  const box = document.getElementById('toasts');
  const el = document.createElement('div');
  el.className = `toast ${cls}`;
  el.textContent = msg;
  box.appendChild(el);
  requestAnimationFrame(()=>el.classList.add('show'));
  setTimeout(()=>{ el.classList.remove('show'); setTimeout(()=>el.remove(),200); }, 3000);
}
async function notify(msg, color=''){
  try{
    if('Notification' in window){
      if(Notification.permission==='default'){ await Notification.requestPermission().catch(()=>{}); }
      if(Notification.permission==='granted'){
        const n = new Notification('Timecove', { body: msg, silent:true });
        setTimeout(()=>n.close(), 3500);
      }
    }
  }catch{}
  if(navigator.vibrate){ navigator.vibrate(40); }
  toast(msg, color);
}

/* --------- MODEL (with persistence) --------- */
const model = {
  lyo:  { mood:'calm', needs:[], nextFeedAt:null, bottle:'EchoSip', log:[], diaperLog:[], intervalMin:135, wakeAt:null, diaperSince:null, lastDiaperNudge:null },
  lya:  { mood:'calm', needs:[], nextFeedAt:null, bottle:'EchoSip', log:[], diaperLog:[], intervalMin:165, wakeAt:null, diaperSince:null, lastDiaperNudge:null }
};

function loadState(){
  try{
    const saved = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
    ['lyo','lya'].forEach(id=>{ if(saved[id]) Object.assign(model[id], saved[id]); });
  }catch{}
}
function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(model));
  localStorage.setItem(STORAGE_KEY + '.pulse', String(Date.now()));
}

/* -------- Feeding timers -------- */
function scheduleNextFeed(id){
  model[id].nextFeedAt = Date.now() + model[id].intervalMin * MILLIS_PER_MIN;
  saveState();
}
function ensureTimers(){
  ['lyo','lya'].forEach(id=>{ if(!model[id].nextFeedAt) scheduleNextFeed(id); });
}
function checkFeeding(id){
  const now = Date.now(), next = model[id].nextFeedAt;
  if(!next){ scheduleNextFeed(id); return; }
  if(now >= next && !model[id].needs.includes('Hungry')){
    model[id].needs.push('Hungry');
    renderChild(id); saveState();
    chimeHungry();
    notify(`${cap(id)} is hungry`, 't-red');
  }
}

/* -------- Sleep / Wake + random needs -------- */
function scheduleRandomWake(id){
  const mins = randInt(SLEEP_RANDOM.min, SLEEP_RANDOM.max);
  model[id].wakeAt = Date.now() + mins * MILLIS_PER_MIN;
  saveState();
}
function addDiaperNeed(id){
  if(!model[id].needs.includes('Diaper')){
    model[id].needs.push('Diaper');
    if(!model[id].diaperSince) model[id].diaperSince = Date.now();
  }
}
function checkWake(id){
  if(model[id].mood!=='sleeping' || !model[id].wakeAt) return;
  if(Date.now() >= model[id].wakeAt){
    model[id].mood='calm';
    model[id].wakeAt=null;

    if(Math.random() < HUNGRY_ON_WAKE_PROB && !model[id].needs.includes('Hungry')) {
      model[id].needs.push('Hungry');
      chimeHungry();
      notify(`${cap(id)} woke up hungry`, 't-red');
    }
    if(Math.random() < DIAPER_ON_WAKE_PROB) {
      addDiaperNeed(id);
      notify(`${cap(id)} needs a diaper change`, 't-orange');
    }

    renderChild(id); saveState();
  }
}

/* -------- Gentle nudge for unattended diaper -------- */
function checkDiaperNudge(id){
  if(!model[id].needs.includes('Diaper') || !model[id].diaperSince) return;

  const elapsedMin = (Date.now() - model[id].diaperSince) / MILLIS_PER_MIN;
  const threshold = DIAPER_NUDGE_MIN;
  const last = model[id].lastDiaperNudge || 0;

  // Nudge first time after threshold; then again every threshold minutes
  if(elapsedMin >= threshold && (Date.now()-last) >= threshold*MILLIS_PER_MIN){
    model[id].lastDiaperNudge = Date.now();
    saveState();
    notify(`${cap(id)} still needs a diaper change`, 't-orange');

    // pulse the orange ring briefly if visible
    const g = document.getElementById(id+'-rings');
    const ring = [...g.querySelectorAll('.ring')].find(r => r.style.stroke === COLOR.diaper);
    if(ring){ ring.classList.add('nudgePulse'); setTimeout(()=>ring.classList.remove('nudgePulse'), 2800); }
  }

  // Show waiting time text
  const waitEl = document.getElementById(id+'-diaper-wait');
  const mins = Math.floor(elapsedMin);
  const secs = Math.floor((elapsedMin - mins) * (DEMO?60:60)); // same visual both modes
  waitEl.textContent = `Diaper waiting: ${mins}m ${String(secs).padStart(2,'0')}s`;
}
function clearDiaperTimers(id){
  model[id].diaperSince = null;
  model[id].lastDiaperNudge = null;
}

/* -------- Resolve actions -------- */
function feedBaby(id){
  const idx = model[id].needs.indexOf('Hungry');
  if(idx>-1) model[id].needs.splice(idx,1);
  if(model[id].mood!=='sleeping') model[id].mood='calm';

  const entry = { ts: Date.now(), bottle: model[id].bottle || 'Bottle' };
  model[id].log.unshift(entry);
  if(model[id].log.length>30) model[id].log.length = 30;

  scheduleNextFeed(id);
  renderChild(id); saveState(); chimeFed();
  notify(`Fed ${cap(id)}`, 't-teal');
}
function changeDiaper(id){
  const idx = model[id].needs.indexOf('Diaper');
  if(idx>-1) model[id].needs.splice(idx,1);
  if(model[id].mood!=='sleeping') model[id].mood='calm';

  // log the change
  model[id].diaperLog.unshift({ ts: Date.now(), note:'Changed' });
  if(model[id].diaperLog.length>30) model[id].diaperLog.length = 30;

  clearDiaperTimers(id);
  renderChild(id); saveState();
  notify(`${cap(id)} is fresh & comfy`, 't-teal');

  // clear wait label
  const waitEl = document.getElementById(id+'-diaper-wait');
  if(waitEl) waitEl.textContent = '';
}

/* ------- RENDERING ------- */
function $(id){ return document.getElementById(id); }

function renderChild(id){
  // bottle + interval inputs
  const sel = $(id+'-bottle'); if(sel) sel.value = model[id].bottle;
  const h = Math.floor(model[id].intervalMin/60), m = model[id].intervalMin%60;
  const hEl=$(id+'-h'), mEl=$(id+'-m'); if(hEl) hEl.value=h; if(mEl) mEl.value=m;

  // baseline
  const base = $(id+'-base');
  base.classList.toggle('calm', model[id].mood==='calm');
  base.classList.toggle('sleep', model[id].mood==='sleeping');

  // need rings (order: Hungry red outer, Diaper orange inner)
  const g = $(id+'-rings'); g.innerHTML='';
  const needs = model[id].needs.slice();
  const mkRing = (r, color)=>{
    const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
    c.setAttribute('cx','50'); c.setAttribute('cy','50'); c.setAttribute('r', String(r));
    c.setAttribute('class','ring'); c.setAttribute('style', `stroke:${color}; color:${color}`);
    return c;
  };
  if(needs.includes('Hungry')) g.appendChild(mkRing(38, COLOR.hungry));
  if(needs.includes('Diaper')){
    const r = needs.includes('Hungry') ? 33 : 38;
    g.appendChild(mkRing(r, COLOR.diaper));
  }

  // resolve controls
  const controls = $(id+'-controls'); controls.innerHTML='';
  if(needs.includes('Hungry')){
    const b = document.createElement('button');
    b.className='pill resolve hungry'; b.textContent='Feed';
    b.onclick=()=>{
      const ring = g.querySelector('.ring'); // first (might be hungry)
      if(ring){ ring.classList.add('cooldown'); setTimeout(()=>feedBaby(id), 900); }
      else feedBaby(id);
    };
    controls.appendChild(b);
  }
  if(needs.includes('Diaper')){
    const b = document.createElement('button');
    b.className='pill resolve diaper'; b.textContent='Change Diaper';
    b.onclick=()=>{
      const rings = [...g.querySelectorAll('.ring')];
      const orange = rings.find(r=>r.style.stroke===COLOR.diaper);
      if(orange){ orange.classList.add('cooldown'); setTimeout(()=>changeDiaper(id), 900); }
      else changeDiaper(id);
    };
    controls.appendChild(b);
  }

  // mood toggles
  const moodRow = $(id+'-mood'); moodRow.innerHTML='';
  const calmBtn = document.createElement('button');
  calmBtn.className = 'pill toggle ' + (model[id].mood==='calm' ? 'active calm':'');
  calmBtn.textContent = 'Set Calm';
  calmBtn.onclick = ()=>{ model[id].mood='calm'; model[id].wakeAt=null; renderChild(id); saveState(); };

  const sleepBtn = document.createElement('button');
  sleepBtn.className = 'pill toggle ' + (model[id].mood==='sleeping' ? 'active sleep':'');
  sleepBtn.textContent = 'Set Sleeping';
  sleepBtn.onclick = ()=>{ model[id].mood='sleeping'; scheduleRandomWake(id); renderChild(id); saveState(); };

  moodRow.appendChild(calmBtn);
  moodRow.appendChild(sleepBtn);

  renderLogs(id);
  updateCountdown(id);

  // show elapsed diaper wait (if any)
  const waitEl = document.getElementById(id+'-diaper-wait');
  if(model[id].needs.includes('Diaper') && model[id].diaperSince){
    const mins = Math.floor((Date.now()-model[id].diaperSince)/MILLIS_PER_MIN);
    waitEl.textContent = `Diaper waiting: ${mins}m`;
  } else { waitEl.textContent = ''; }
}

function renderLogs(id){
  // Feeding log
  const feedWrap = $(id+'-log').querySelector('.entries.feed');
  feedWrap.innerHTML='';
  const feeds = model[id].log || [];
  if(feeds.length===0){
    feedWrap.innerHTML = `<div class="entry"><span class="ts">No feedings yet.</span><span></span></div>`;
  }else{
    feeds.forEach(e=>{
      feedWrap.insertAdjacentHTML('beforeend',
        `<div class="entry"><span class="ts">${fmtTs(e.ts)}</span><span class="tag">${html(e.bottle)}</span></div>`);
    });
  }
  // Diaper log
  const diaWrap = $(id+'-log').querySelector('.entries.diaper');
  diaWrap.innerHTML='';
  const dlog = model[id].diaperLog || [];
  if(dlog.length===0){
    diaWrap.innerHTML = `<div class="entry"><span class="ts">No diaper changes yet.</span><span></span></div>`;
  }else{
    dlog.forEach(e=>{
      diaWrap.insertAdjacentHTML('beforeend',
        `<div class="entry"><span class="ts">${fmtTs(e.ts)}</span><span class="tag">Changed</span></div>`);
    });
  }
}

function fmtTs(ms){
  const d = new Date(ms);
  return d.toLocaleString([], { hour:'numeric', minute:'2-digit', month:'short', day:'numeric' });
}
function html(s){ return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

function formatETA(ms){
  if(ms <= 0) return 'due';
  const totalSec = Math.ceil(ms / 1000);
  const h = Math.floor(totalSec / 3600);
  const m = Math.floor((totalSec % 3600) / 60);
  const s = totalSec % 60;
  if(!DEMO){ return `${h}h ${m}m`; }
  return (h>0?`${h}h `:'') + `${m}m ${String(s).padStart(2,'0')}s`;
}
function updateCountdown(id){
  const etaEl = $(id+'-eta');
  if(!model[id].nextFeedAt){ etaEl.textContent='—'; return; }
  const ms = model[id].nextFeedAt - Date.now();
  etaEl.textContent = formatETA(ms);
}

/* ------- Controls: bottle + interval save ------- */
['lyo','lya'].forEach(id=>{
  $(id+'-bottle').addEventListener('change', ()=>{
    model[id].bottle = $(id+'-bottle').value; saveState(); renderLogs(id);
  });
  $(id+'-save').addEventListener('click', ()=>{
    const hours = Math.max(0, parseInt($(id+'-h').value||'0',10));
    const mins  = Math.max(0, Math.min(59, parseInt($(id+'-m').value||'0',10)));
    model[id].intervalMin = hours*60 + mins; if(model[id].intervalMin===0) model[id].intervalMin=1;
    scheduleNextFeed(id); renderChild(id);
    toast(`${cap(id)} feeding interval updated`, 't-teal');
  });
});

/* -------- Init + timers -------- */
loadState();
ensureAudio();
ensureTimers();
renderChild('lyo');
renderChild('lya');

setInterval(()=>{
  ['lyo','lya'].forEach(id=>{
    checkFeeding(id);
    checkWake(id);
    checkDiaperNudge(id);
    updateCountdown(id);
  });
}, 500);

/* -------- Cross-tab sync -------- */
window.addEventListener('storage', (ev)=>{
  if(ev.key===STORAGE_KEY || ev.key===STORAGE_KEY+'.pulse'){
    loadState(); renderChild('lyo'); renderChild('lya');
  }
});

/* -------- Helpers -------- */
function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min; }
function cap(id){ return id==='lyo'?'Lyo':'Lya'; }
</script>
</body>
</html>



